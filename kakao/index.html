<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="utf-8">
  <title>Sk√¶kkulator ‚Äî THC-kakao</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 780px;
      margin: 20px auto;
      background: #fbfbfb;
      padding: 18px;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.06);
    }

    h1 {
      text-align: center;
      margin-bottom: 4px;
    }

    p.lead {
      text-align: center;
      color: #444;
      margin-top: 0;
      margin-bottom: 12px;
      font-size: 14px;
    }

    label {
      display: block;
      margin-top: 12px;
      font-weight: 600;
      color: #222;
    }

    input, select {
      margin-top: 6px;
      width: 100%;
      padding: 8px 10px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 14px;
      box-sizing: border-box;
    }

    .row {
      display: flex;
      gap: 12px;
    }

    .col {
      flex: 1;
    }

    /* FIXED Manual Input checkbox centering */
    /* iOS: sentrer checkbox i checkbox-inline */
.checkbox-inline {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
}

.checkbox-inline input[type="checkbox"] {
  margin: 0;       /* fjerner u√∏nsket margin */
  width: auto;     /* ikke stretch til 100% */
}

    button {
      margin-top: 16px;
      padding: 12px;
      width: 100%;
      font-size: 16px;
      border-radius: 8px;
      border: 0;
      background: #2b9aef;
      color: #fff;
      cursor: pointer;
    }

    #result {
      margin-top: 18px;
      padding: 12px;
      border-radius: 8px;
      background: #fff;
      border: 1px solid #eee;
    }

    .warn {
      background: #fff7e6;
      border: 1px solid #ffd08a;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 10px;
      color: #7a4b00;
      display: none;
    }

    .note {
      font-size: 13px;
      color: #555;
      margin-top: 8px;
    }

    small {
      color: #666;
      display: block;
      margin-top: 6px;
    }

    .meta {
      font-size: 13px;
      color: #666;
      margin-top: 8px;
    }

    /* FIXED Force Refresh knapp */
    #forceRefreshBtn {
      margin-top: 10px;
      background: #555;
      color: #fff;
      border-radius: 6px;
      padding: 10px;
      cursor: pointer;
    }

    #forceRefreshBtn:hover {
      background: #666;
    }
    body {
  padding-bottom: calc(18px + env(safe-area-inset-bottom));
}
  </style>
</head>
<body>
  <h1>Sk√¶kkulator ‚Äî THC-kakao</h1>
  <p class="lead">Raskt estimat av THC per kopp med fett-justering, advarsel ved h√∏y dose, og litt koselig tekst üé∂</p>

  <div class="checkbox-inline">
    <label for="manualInput">Manual input</label>
    <input id="manualInput" type="checkbox">
  </div>


  <label>Gram hasj:</label>
  <input id="grams" type="number" min="0" step="0.01" value="1">

  <label>Styrke p√• hasj:</label>

  <select id="strengthSelect">
    <option value="0.10">Svak (~10% THC)</option>
    <option value="0.15">Middels (~15% THC)</option>
    <option value="0.20">Sterk (~20% THC)</option>
    <option value="0.25">Ekstra sterk (~25% THC)</option>
    <option value="0.4">Psykopat (~40% THC)</option>
    <option value="0">Ukjent (bruk gjennomsnitt 15%)</option>
  </select>

  <input
    id="strengthManual"
    type="number"
    min="0"
    max="100"
    step="0.1"
    placeholder="THC %"
    style="display:none;">

  <label>Konsistens:</label>
  <select id="consistency">
    <option value="0.92">T√∏rr / lys</option>
    <option value="1">Mellom</option>
    <option value="1.08">Oljete / m√∏rk</option>
    <option value="1">Ukjent</option>
  </select>

  <div class="row">
    <div class="col">
      <label>Type melk:</label>

      <select id="milkSelect">
        <option value="0.005">Ekstra lett (0.5% fett)</option>
        <option value="0.01">Lett (1.0% fett)</option>
        <option value="0.0225">Lett + Hel (2.25% fett)</option>
        <option value="0.02">Ekstra + Hel (2.0% fett)</option>
        <option value="0.035">Helmelk (3.5% fett)</option>
      </select>

      <input
        id="milkManual"
        type="number"
        min="0"
        step="0.1"
        placeholder="Fett % melk"
        style="display:none;">

      <small>Velg den melketypen du bruker ‚Äî fett √∏ker hvor mye THC som l√∏ses i blandingen.</small>
    </div>

    <div class="col">
      <label>Sjokop√•legg:</label>

      <select id="chocoFatSelect">
        <option value="0.309">Nutella (30.9%)</option>
        <option value="0.36">Coop Extra (36.0%)</option>
        <option value="0.365">First Price (36.5%)</option>
      </select>

      <input
        id="chocoFatManual"
        type="number"
        min="0"
        step="0.1"
        placeholder="Fett % sjokop√•legg"
        style="display:none;">

      <small>Dette representerer fettandelen i sjokop√•legget ‚Äî h√∏yere fett betyr mer effektiv l√∏sing av THC i fettfase.</small>
    </div>
  </div>

  <div class="checkbox-inline">
    <label for="useChocoButter">Sjokosm√∏r?</label>
    <input id="useChocoButter" type="checkbox" checked>
  </div>

  <label>Antall kopper (fordeling):</label>
  <input id="cups" type="number" min="1" step="1" value="1">

  <button onclick="calculateTHC()">Regn THC per kopp</button>

  <div id="result">
    <div id="warn" class="warn"></div>
    <div id="out"></div>
    <div class="meta" id="metaSources"></div>
  </div>

<script>
document.getElementById('manualInput').addEventListener('change', function () {

  const show = this.checked;

  document.getElementById('strengthSelect').style.display = show ? 'none' : 'block';
  document.getElementById('strengthManual').style.display = show ? 'block' : 'none';

  document.getElementById('milkSelect').style.display = show ? 'none' : 'block';
  document.getElementById('milkManual').style.display = show ? 'block' : 'none';

  document.getElementById('chocoFatSelect').style.display = show ? 'none' : 'block';
  document.getElementById('chocoFatManual').style.display = show ? 'block' : 'none';
});

function chooseQuote() {
  const normal = [
    "Bare kos deg, ikke stress ‚Äì livet er kakao og fred ‚òïüåø",
    "Chill, sett deg i sofaen, sl√• p√• litt musikk og smelt inn i universet üé∂",
    "En kopp med ro, bror. Ikke mer, ikke mindre üòå",
    "THC + kakao = kj√¶rlighet med fett üåà",
    "Du er trygg, du er myk, du er varm ‚Äì som sjokolade i panna üò¥",
    "Alt g√•r sakte, men riktig. Akkurat som √• r√∏re i en gryte med kos üç´",
    "Livet er fett, literally, n√•r du har helmelk i miksen üí™",
    "Du blir ikke h√∏y, du blir opplyst üî•",
    "Om du h√∏rer lyder i veggen ‚Äì det er bare deg selv, bror üò≥",
    "Kakaoen smiler til deg n√•. Smil tilbake üòå",
    "Legg deg ned, bli en teppeburrito og bare lev ü•∞",
    "Ikke tenk for mye ‚Äì bare flyt, du eier lufta n√• üí®",
    "Du er i slow motion n√•, men verden f√∏lger ikke med üòÇ",
    "Hvis du mister koppen, s√• var det skjebnen ‚òïüíÄ",
    "Alt er chill til du ser lyset danse p√• taket, da er du midt i sonen üåå",
    "Dette er ikke bare kakao, det er livsfilosofi i koppform ü§Ø",
    "Du kjenner det ikke f√∏rst, men plutselig ‚Äì pang, kos üíö",
    "Du smelter som sm√∏r i varm melk n√• üòµ",
    "Ikke pr√∏v √• st√•, bror. Sofaen vant kampen üõãÔ∏è",
    "Kos, ro, varme, fred. THC sitt evangelium üòá"
  ];

  return normal[Math.floor(Math.random() * normal.length)];
}

function calculateTHC() {

  const grams = parseFloat(document.getElementById('grams').value) || 0;
  const consistency = parseFloat(document.getElementById('consistency').value) || 1;
  const cups = Math.max(1, parseInt(document.getElementById('cups').value) || 1);
  const useChocoButter = document.getElementById('useChocoButter').checked;
  const manual = document.getElementById('manualInput').checked;

  let strength;
  let milkFat;
  let chocoFat;

  if (manual) {

    strength = (parseFloat(document.getElementById('strengthManual').value) || 0) / 100;
    milkFat  = (parseFloat(document.getElementById('milkManual').value) || 0) / 100;
    chocoFat = (parseFloat(document.getElementById('chocoFatManual').value) || 0) / 100;

  } else {

    strength = parseFloat(document.getElementById('strengthSelect').value);
    milkFat  = parseFloat(document.getElementById('milkSelect').value) || 0.01;
    chocoFat = parseFloat(document.getElementById('chocoFatSelect').value) || 0.309;

  }

  if (strength === 0) strength = 0.15;

  const totalTHC_raw = grams * strength * 1000;

  let fatScore = milkFat * 100;
  fatScore = fatScore * 0.6;

  if (useChocoButter) fatScore += chocoFat * 100 * 0.9;
  else fatScore += chocoFat * 100 * 0.45;

  const fatMultiplier = 0.55 + fatScore / 100;

  const totalTHC_available = totalTHC_raw * consistency * fatMultiplier;
  const thcPerCup = totalTHC_available / cups;
  const percentOfRawPerCup = totalTHC_raw > 0
    ? (thcPerCup / totalTHC_raw) * 100
    : 0;

  let effect = '';
  if (thcPerCup < 10) effect = 'Mild';
  else if (thcPerCup < 30) effect = 'Middels';
  else if (thcPerCup < 60) effect = 'Sterk';
  else effect = 'Ekstrem';

  const warnEl = document.getElementById('warn');

  if (thcPerCup > 50) {
    warnEl.style.display = 'block';
    warnEl.innerHTML =
      '‚ö†Ô∏è Advarsel: H√∏y dose (over 50 mg THC per kopp). Ta det rolig, start med en liten mengde, ha vann og snacks tilgjengelig ‚Äî og kos deg.';
  } else {
    warnEl.style.display = 'none';
  }

  // --- REAL INFUSION LOGIC ---

const thcLoad = grams * strength * 1000;

const effectiveFat =
  (milkFat * 100 * 0.6) +
  (chocoFat * 100 * (useChocoButter ? 0.9 : 0.45));

const thcPerFatUnit = thcLoad / Math.max(1, effectiveFat);

let extraTime;

if (thcPerFatUnit < 4) extraTime = 2;
else if (thcPerFatUnit < 8) extraTime = 4;
else if (thcPerFatUnit < 14) extraTime = 7;
else if (thcPerFatUnit < 20) extraTime = 11;
else extraTime = 16;

  const quote = chooseQuote();

  const out = document.getElementById('out');
  out.innerHTML =
    `<strong>Omtrentlig THC per kopp:</strong> ${thcPerCup.toFixed(1)} mg` +
    ` <small>(${percentOfRawPerCup.toFixed(1)}% av r√•-THC per kopp)</small><br>` +
    `<strong>Estimert effekt:</strong> ${effect}<br>` +
    `<strong>Anbefalt ekstra varighet:</strong> ca ${extraTime.toFixed(0)} minutter ekstra for best infusjon.<br>` +
    `<div style="margin-top:8px;"><em>${quote}</em></div>`;

  const meta = document.getElementById('metaSources');
  meta.innerHTML = 'Kilder: THC er fettl√∏selig og varme aktiverer THCA ‚Üí THC (NCBI/PMC, oversiktsartikler).';
}

// --- DEV: Force Refresh uten √• slette tabeller ---
function forceRefresh() {
  const url = new URL(window.location.href);
  url.searchParams.set('v', Date.now());
  window.location.href = url.toString();
}
</script>

<button onclick="forceRefresh()">Force refresh</button>

</body>
</html>